/*
 * Hasher <http://github.com/millermedeiros/Hasher>
 * Includes: MM.EventDispatcher (0.8.2), MM.queryUtils (0.8.2), MM.event-listenerFacade (0.3)
 * @author Miller Medeiros <http://www.millermedeiros.com/>
 * @version 0.9.7 (2010/11/01)
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
var millermedeiros={};millermedeiros.EventDispatcher=function(){this._handlers={};this._disabled=[]};millermedeiros.EventDispatcher.prototype={addEventListener:function(a,b){if(typeof this._handlers[a]=="undefined"){this._handlers[a]=[]}this._handlers[a].push(b)},removeEventListener:function(b,c){if(!this.hasEventListener(b)){return}var a=this._handlers[b],d=a.length;if(d==1){delete this._handlers[b]}else{while(d--){if(a[d]==c){a.splice(d,1);break}}}},removeAllEventListeners:function(a){if(typeof a==="string"&&this.hasEventListener(a)){delete this._handlers[a]}else{if(a){this._handlers={}}}},hasEventListener:function(a){return(typeof this._handlers[a]!="undefined")},dispatchEvent:function(a){a=(typeof a=="string")?{type:a}:a;if(this.hasEventListener(a.type)){var b=this._handlers[a.type],d,c,e=b.length;a.target=a.target||this;for(c=0;c<e;c++){d=b[c];d(a)}return true}return false},willDispatch:function(b){var a=this._disabled.length;while(a--){if(this._disabled[a]===b){return false}}return true},disableEvent:function(c){var b=Array.prototype.slice.call(arguments,0),d=b.length,a;while(d--){a=b[d];if(this.willDispatch(a)){this._disabled.push(a)}}},enableEvent:function(d){var c=Array.prototype.slice.call(arguments,0),e=c.length,a,b;while(e--){b=c[e];a=this._disabled.length;while(a--){if(this._disabled[a]===b){this._disabled.splice(a,1)}}}}};millermedeiros.queryUtils={getQueryString:function(a){a=a||location.href;a=a.replace(/#[\w\W]*/,"");var b=/\?[a-zA-Z0-9\=\&\%\$\-\_\.\+\!\*\'\(\)\,]+/.exec(a);return(b)?decodeURIComponent(b[0]):""},getQueryObject:function(a){return this.toQueryObject(this.getQueryString(a))},toQueryObject:function(e){var a=e.replace("?","").split("&"),d=a.length,c={},b;while(d--){a[d]=a[d].split("=");b=a[d][1];c[a[d][0]]=isNaN(b)?b:parseFloat(b)}return c},getParamValue:function(e,b){b=b||location.href;var d=new RegExp("(\\?|&)"+e+"=([^&]*)"),a=d.exec(b),c=(a&&a[2])?a[2]:null;return isNaN(c)?c:parseFloat(c)},hasParam:function(c,a){var b=new RegExp("(\\?|&)"+c+"=","g");return b.test(this.getQueryString(a))},toQueryString:function(b){var a=[],c;for(c in b){if(b.hasOwnProperty(c)){a.push(c+"="+b[c])}}return(a.length)?"?"+a.join("&"):""}};millermedeiros.event=millermedeiros.event||{};millermedeiros.event.addListener=function(c,a,b){if(c.addEventListener){c.addEventListener(a,b,false)}else{if(c.attachEvent){c.attachEvent("on"+a,b)}else{c["on"+a]=b}}};millermedeiros.event.removeListener=function(c,a,b){if(c.removeEventListener){c.removeEventListener(a,b,false)}else{if(c.detachEvent){c.detachEvent("on"+a,b)}else{c["on"+a]=null}}};var HasherEvent=function(a,c,b){this.type=a;this.oldHash=c;this.newHash=b};HasherEvent.prototype.toString=function(){return'[HasherEvent type="'+this.type+'" oldHash="'+this.oldHash+'" newHash="'+this.newHash+'"]'};HasherEvent.CHANGE="change";HasherEvent.INIT="init";HasherEvent.STOP="stop";(function(i,n,a,l){var q,k,x,b,m=navigator.userAgent,g=/MSIE/.test(m)&&(!i.opera),u=("onhashchange" in i),c=/MSIE (6|7)/.test(m)&&!u,o=(a.protocol==="file:"),s=millermedeiros,d=new s.EventDispatcher(),y=s.queryUtils,e=s.event;function p(A){var z=new RegExp("^\\"+d.prependHash+"|\\"+d.appendHash+"$","g");return A.replace(z,"")}function t(){return(b)?b.contentWindow.frameHash:null}function f(A){if(b&&A!=t()){var z=b.contentWindow.document;z.open();z.write("<html><head><title>"+d.getTitle()+'</title><script type="text/javascript">var frameHash="'+A+'";<\/script></head><body>&nbsp;</body></html>');z.close()}}function j(z){z=decodeURIComponent(z);if(q!=z){var A=q;q=z;if(c){f(z)}d.dispatchEvent(new HasherEvent(HasherEvent.CHANGE,p(A),p(z)))}}function r(){b=n.createElement("iframe");b.src="about:blank";b.style.display="none";n.body.appendChild(b)}function w(){var z=/#(.*)$/.exec(d.getURL());return(z&&z[1])?decodeURIComponent(z[1]):""}function v(){var z=w();if(z!=q){j(z)}}function h(){var A=w(),z=t();if(z!=q&&z!=A){d.setHash(z)}else{if(A!=q){j(A)}}}this.Hasher=d;d.VERSION="0.9.7";d.appendHash="/";d.prependHash="/";d.separator="/";d.init=function(){if(x){return}var z=q;q=w();if(u){e.addListener(i,"hashchange",v)}else{if(c){if(!b){r();f(q)}k=setInterval(h,25)}else{k=setInterval(v,25)}}x=true;this.dispatchEvent(new HasherEvent(HasherEvent.INIT,z,q))};d.stop=function(){if(!x){return}if(u){e.removeListener(i,"hashchange",v)}else{clearInterval(k);k=null}x=false;this.dispatchEvent(new HasherEvent(HasherEvent.STOP,q,q))};d.getURL=function(){return a.href};d.getBaseURL=function(){return this.getURL().replace(/(\?.*)|(\#.*)/,"")};d.setHash=function(z){z=(z)?this.prependHash+z.replace(/^\#/,"")+this.appendHash:z;if(z!=q){j(z);if(g&&o){z=z.replace(/\?/,"%3F")}a.hash="#"+encodeURI(z)}};d.getHash=function(){return p(q)};d.getHashAsArray=function(){return this.getHash().split(this.separator)};d.getHashQuery=function(){return y.getQueryString(this.getHash()).substr(1)};d.getHashQueryAsObject=function(){return y.toQueryObject(this.getHashQuery())};d.getHashQueryParam=function(z){return y.getParamValue(z,this.getHash())};d.setTitle=function(z){n.title=z};d.getTitle=function(){return n.title};d.back=function(){l.back()};d.forward=function(){l.forward()};d.go=function(z){l.go(z)};d.dispose=function(){d.removeAllEventListeners(true);d.stop();q=k=x=b=m=g=c=u=o=y=e=d=i.Hasher=null};d.toString=function(){return'[Hasher version="'+this.VERSION+'" hash="'+this.getHash()+'"]'}}(window,document,window.location,history));