/*
 * Hasher <http://github.com/millermedeiros/Hasher>
 * Includes: MM.EventDispatcher (0.8), MM.queryUtils (0.7), MM.event-listenerFacade (0.3)
 * @author Miller Medeiros <http://www.millermedeiros.com/>
 * @version 0.9.3 (2010/07/26)
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
var MM=MM||{};MM.EventDispatcher=function(){this._handlers={}};MM.EventDispatcher.prototype={addEventListener:function(a,b){if(typeof this._handlers[a]=="undefined"){this._handlers[a]=[]}this._handlers[a].push(b)},removeEventListener:function(b,c){if(!this.hasEventListener(b)){return}var a=this._handlers[b],d=a.length;if(d==1){delete this._handlers[b]}else{while(d--){if(a[d]==c){a.splice(d,1);break}}}},removeAllEventListeners:function(a){if(a===true){this._handlers={}}else{if(this.hasEventListener(a)){delete this._handlers[a]}}},hasEventListener:function(a){return(typeof this._handlers[a]!="undefined")},dispatchEvent:function(a){a=(typeof a=="string")?{type:a}:a;if(this.hasEventListener(a.type)){var b=this._handlers[a.type],d,c,e=b.length;a.target=a.target||this;for(c=0;c<e;c++){d=b[c];d(a)}}}};var MM=MM||{};MM.queryUtils={getQueryString:function(a){a=a||location.href;a=a.replace(/#[\w\W]*/,"");var b=/\?[a-zA-Z0-9\=\&\%\$\-\_\.\+\!\*\'\(\)\,]+/.exec(a);return(b)?decodeURIComponent(b[0]):""},getQueryObject:function(a){return this.toQueryObject(this.getQueryString(a))},toQueryObject:function(d){var a=d.replace("?","").split("&"),c=a.length,b={};while(c--){a[c]=a[c].split("=");b[a[c][0]]=a[c][1]}return b},getParamValue:function(b,a){return this.getQueryObject(a)[b]},hasParam:function(c,a){var b=new RegExp("(\\?|&)"+c+"=","g");return b.test(this.getQueryString(a))},toQueryString:function(b){var a=[],c;for(c in b){if(b.hasOwnProperty(c)){a.push(c+"="+b[c])}}return(a.length)?"?"+a.join("&"):""}};var MM=MM||{};MM.event=MM.event||{};MM.event.addListener=function(c,a,b){if(c.addEventListener){c.addEventListener(a,b,false)}else{if(c.attachEvent){c.attachEvent("on"+a,b)}else{c["on"+a]=b}}};MM.event.removeListener=function(c,a,b){if(c.removeEventListener){c.removeEventListener(a,b,false)}else{if(c.detachEvent){c.detachEvent("on"+a,b)}else{c["on"+a]=null}}};var HasherEvent=function(a,c,b){this.type=a;this.oldHash=c;this.newHash=b};HasherEvent.prototype.toString=function(){return'[HasherEvent type="'+this.type+'" oldHash="'+this.oldHash+'" newHash="'+this.newHash+'"]'};HasherEvent.CHANGE="change";HasherEvent.INIT="init";HasherEvent.STOP="stop";(function(h,l,a,k,c){var n,j,s,b,d=/MSIE (6|7)/.test(navigator.userAgent)&&(!+"\v1"),p=("onhashchange" in h),e=new MM.EventDispatcher(),t=MM.queryUtils,m=MM.event;function i(u){if(n!=u){var v=n;n=u;if(s){e.dispatchEvent(new HasherEvent(HasherEvent.CHANGE,v,u))}}}function o(){b=l.createElement("iframe");b.src="about:blank";b.style.display="none";l.body.appendChild(b)}function f(v){var u=b.contentWindow.document;u.open();u.write("<html><head><title>"+e.getTitle()+'</title><script type="text/javascript">var frameHash="'+v+'";<\/script></head><body>&nbsp;</body></html>');u.close()}function r(){var u=/#(.*)$/.exec(e.getURL());return(u&&u[1])?decodeURIComponent(u[1]):""}function q(){var u=r();if(u!=n){i(u)}}function g(){var v=r(),u=b.contentWindow.frameHash;if(u!=v&&u!=n){e.setHash(u);i(u)}else{if(v!=n){if(u!=v){f(v)}i(v)}}}this.Hasher=e;e.init=function(){if(s){return}var u=n;n=r();if(p){MM.event.addListener(h,"hashchange",q)}else{if(d){if(!b){o();f(n)}j=setInterval(g,25)}else{j=setInterval(q,25)}}s=true;this.dispatchEvent(new HasherEvent(HasherEvent.INIT,u,n))};e.stop=function(){if(!s){return}if(p){MM.event.removeListener(h,"hashchange",q)}else{clearInterval(j);j=null}s=false;this.dispatchEvent(new HasherEvent(HasherEvent.STOP,n,n))};e.getURL=function(){return a.href};e.getBaseURL=function(){return a.href.replace(/(\?.*)|(\#.*)/,"")};e.setHash=function(u){u=(u)?u.replace(/^\#/,""):u;if(u!=n){a.hash=u;i(u)}};e.getHash=function(){return n};e.getHashAsArray=function(w){w=w||"/";var v=this.getHash(),u=new RegExp("^\\"+w+"|\\"+w+"$","g");v=v.replace(u,"");return v.split(w)};e.getHashQuery=function(){return t.getQueryString(this.getHash()).substr(1)};e.getHashQueryAsObject=function(){return t.toQueryObject(this.getHashQuery())};e.getHashQueryParam=function(u){return t.getParamValue(u,this.getHash())};e.setTitle=function(u){l.title=u};e.getTitle=function(){return l.title};e.back=function(){k.back()};e.forward=function(){k.forward()};e.go=function(u){k.go(u)}}(window,document,location,history));