<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<link rel="stylesheet" href="./qunit/qunit.css" type="text/css" media="screen" />
		<script type="text/javascript" src="./qunit/qunit.js"></script>
		<script type="text/javascript" src="../../lib/MM_EventDispatcher.js"></script>
		<script type="text/javascript" src="../../lib/MM_queryUtils.js"></script>
		<script type="text/javascript" src="../../src/HasherEvent.js"></script>
		<script type="text/javascript" src="../../src/Hasher.js"></script>
		<title>Untitled</title>
	</head>
	<body>
		<h1 id="qunit-header">Hasher basic unit test</h1>
		<h2 id="qunit-banner"></h2>
		<h2 id="qunit-userAgent"></h2>
		<ol id="qunit-tests"></ol>
		<script type="text/javascript">
			
			
			function init(){
				
				
				test("init hasher", function(){
					stop(100);
					expect(4);
					
					ok(! Hasher.hasEventListener(HasherEvent.INIT), "No INIT Listener");
					
					Hasher.addEventListener(HasherEvent.INIT, function(){				
						ok(true, "HasherEvent.INIT dispatched");
						
						Hasher.removeEventListener(HasherEvent.INIT, arguments.callee);
						ok(! Hasher.hasEventListener(HasherEvent.INIT), "Removed INIT Listener");
						
						start();
					});
					
					ok(Hasher.hasEventListener(HasherEvent.INIT), "Added INIT Listener");
					
					Hasher.init();
				});
				
				module('set/get hash/title value');
				
				test('#1', function(){
					stop();
					if(location.hash.substr(1) == 'foo'){
						location.href = Hasher.getBaseURL(); //make sure first call will cause a hash change
						return;
					}
					doChangeTest('foo', 'Foo Bar');
					
				});
				
				test('#2', function(){
					stop();
					doChangeTest('dolor', 'Dolor Sit Amet');
				});
				
				test('#3', function(){
					stop();
					doChangeTest('sit-amet/ipsum', 'Sit Amet Ipsum');
				});
				
				test('#4', function(){
					stop();
					doChangeTest('sit-amet/ipsum/lorem', 'Lorem Ipsum');
				});
				
				test('#5', function(){
					stop();
					doChangeTest('/asd', 'Asd');
				});
				
				test('#6', function(){
					stop();
					doChangeTest('/asd/qwerty?foo=bar', 'Qwerty / Asd ? Foo = Bar');
				});
				
				test('#7', function(){
					stop();
					doChangeTest('/asd/qwerty/', 'Asd Qwerty');
				});
				
			}
			
			function doChangeTest(hash, title){
					expect(7);
					
					ok(! Hasher.hasEventListener(HasherEvent.CHANGE), "No CHANGE Listener");
					
					Hasher.addEventListener(HasherEvent.CHANGE, function(){
						ok(true, "HasherEvent.CHANGE dispatched");
						
						Hasher.removeEventListener(HasherEvent.CHANGE, arguments.callee);
						ok( ! Hasher.hasEventListener(HasherEvent.CHANGE), "Removed CHANGE Listener");
						
						start();
					});
					
					ok(Hasher.hasEventListener(HasherEvent.CHANGE), "Added CHANGE Listener");
					
					Hasher.setHash(hash);
					equals(hash, Hasher.getHash(), "Hasher.setHash() & Hasher.getHash()");
					
					// simple substring to test if regex is correct
					var tmpHash = (hash.charAt(0) == '/')? hash.substr(1) : hash;
					tmpHash = (tmpHash.charAt(tmpHash.length -1 ) == '/')? tmpHash.substring(0, tmpHash.length -1) : tmpHash;
					var hashArray = tmpHash.split('/');
					
					same(hashArray, Hasher.getHashAsArray(), "Hasher.getHashAsArray()");
					
					Hasher.setTitle(title);
					equal(document.title, Hasher.getTitle(), "Hasher.setTitle() & Hasher.getTitle()");
			}
			
			window.onload = init;
			
		</script>
	</body>
</html>
