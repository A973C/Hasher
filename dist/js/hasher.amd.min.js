/*!
 * Hasher <http://github.com/millermedeiros/hasher>
 * @author Miller Medeiros
 * @version 0.9.93+ (2011/08/03 07:26 PM)
 * Released under the MIT License
 */
define("hasher",["signals"],function(a){var b=(function(j){var n=25,o=j.document,c=j.location,m=j.history,s=a.Signal,f,r,l,A,d,y,g=/#(.*)$/,i=(!+"\v1"),w=("onhashchange" in j),e=i&&!w,p=(c.protocol==="file:");function q(C){C=C||"";var B=new RegExp("^\\"+f.prependHash+"|\\"+f.appendHash+"$","g");return C.replace(B,"")}function z(){var B=g.exec(f.getURL());return(B&&B[1])?decodeURIComponent(B[1]):""}function v(){return(d)?d.contentWindow.frameHash:null}function u(){d=o.createElement("iframe");d.src="about:blank";d.style.display="none";o.body.appendChild(d)}function h(){if(d&&r!==v()){var B=d.contentWindow.document;B.open();B.write("<html><head><title>"+o.title+'</title><script type="text/javascript">var frameHash="'+r+'";<\/script></head><body>&nbsp;</body></html>');B.close()}}function k(B){B=decodeURIComponent(B);if(r!==B){var C=r;r=B;if(e){h()}f.changed.dispatch(q(B),q(C))}}y=(e)?function(){var C=z(),B=v();if(B!==r&&B!==C){f.setHash(q(B))}else{if(C!==r){k(C)}}}:function(){var B=z();if(B!==r){k(B)}};function x(D,B,C){if(D.addEventListener){D.addEventListener(B,C,false)}else{if(D.attachEvent){D.attachEvent("on"+B,C)}}}function t(D,B,C){if(D.removeEventListener){D.removeEventListener(B,C,false)}else{if(D.detachEvent){D.detachEvent("on"+B,C)}}}f={VERSION:"0.9.93+",appendHash:"",prependHash:"/",separator:"/",changed:new s(),stopped:new s(),initialized:new s(),init:function(){if(A){return}r=z();if(w){x(j,"hashchange",y)}else{if(e){if(!d){u()}h()}l=setInterval(y,n)}A=true;f.initialized.dispatch(q(r))},stop:function(){if(!A){return}if(w){t(j,"hashchange",y)}else{clearInterval(l);l=null}A=false;f.stopped.dispatch(q(r))},isActive:function(){return A},getURL:function(){return c.href},getBaseURL:function(){return f.getURL().replace(/(\?.*)|(\#.*)/,"")},setHash:function(B){B=(B)?f.prependHash+B.replace(/^\#/,"")+f.appendHash:B;if(B!==r){k(B);if(i&&p){B=B.replace(/\?/,"%3F")}c.hash="#"+encodeURI(B)}},getHash:function(){return q(r)},getHashAsArray:function(){return f.getHash().split(f.separator)},dispose:function(){f.stop();f.initialized.dispose();f.stopped.dispose();f.changed.dispose();d=f=j.hasher=null},toString:function(){return'[hasher version="'+f.VERSION+'" hash="'+f.getHash()+'"]'}};return f}(window));return b});